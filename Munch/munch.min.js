function Munch(){function n(e,r){return Math.floor(Math.random()*(r-e+1))+e}var e=this,r=document.getElementById("battleboard"),a=document.getElementById("control");e.checkItemsGear=function(e){console.log("Проверка бонусов вещей");var r=0;for(var a in e.items)e.items[a].playerGear&&(r+=e.items[a].playerGear(e)),e.items[a].playerWeak&&(r-=e.items[a].playerWeak(e));return r},e.giveChoice=function(n){if(console.log("Дан выбор. Состояние игрока: %s",n.status),"outdoor"==n.status){var s=document.createElement("span");s.className="button",s.onclick=function(){a.innerHTML="",this.onclick=null,e.kickDoor(n)},s.innerHTML="Выбить дверь",a.appendChild(s),r.appendChild(a)}if("endturn"==n.status){var s=document.createElement("span");s.className="button",s.onclick=function(){a.innerHTML="",this.onclick=null,e.endTurn(n)},s.innerHTML="Закончить ход",a.appendChild(s),r.appendChild(a)}if("loser"==n.status){var s=document.createElement("span");s.className="button",s.onclick=function(){a.innerHTML="",this.onclick=null,e.endTurn(n)},s.innerHTML="Бежать",a.appendChild(s),r.appendChild(a)}},e.fight=function(r,a){var n={win:!1,over:0},s=0,o=0;o+=a.level,s+=e.checkItemsGear(r),s+=r.level;for(var i in e.cards.inGame)e.cards.inGame[i].monsterGear&&(o+=e.cards.inGame[i].monsterGear(r)),e.cards.inGame[i].monsterWeak&&(o+=e.cards.inGame[i].monsterWeak(r)),e.cards.inGame[i].playerGear&&(o+=e.cards.inGame[i].playerGear(r)),e.cards.inGame[i].playerWeak&&(o+=e.cards.inGame[i].playerWeak(r));if(s>o?(n.win=!0,n.over=s-o):(n.win=!1,n.over=o-s),e.log("Игрок ОУ[%s] - %s ОУ[%s]",s,a.name,o),n.win){e.log("Вы победили монстра. Награда за него %s сокровище и %s уровень",a.treasure,a.reward),r.addLevel();for(var t=0;t<a.reward;t++)e.takeTreasure(r);console.groupEnd(),e.dropRound()}else e.log("Вы проигрываете монстру %s с перевесом в %s очков. Что будете делать?",a.name,n.over),r.status="loser",e.giveChoise(r);return n},e.run=function(r){var a=0;for(var s in e.cards.inGame)e.cards.inGame[s].runGear&&(a+=e.cards.inGame[s].runGear()),e.cards.inGame[s].runWeak&&(a-=e.cards.inGame[s].runWeak());for(var o in r.items)r.items[o].runGear&&(a+=r.items[o].runGear());var i=n(1,6);console.log("На костях выпало %s и у вас %s бонусов на смыску.",i,a),console.log(i+a>4?"Ты убежал":"Ты не убежал"),console.groupEnd()},e.endTurn=function(r){for(var a in e.cards.inGame)"doors"==e.cards.inGame[a].card?e.moveCard(e.cards.inGame[a],e.cards.inGame,e.cards.doorsFold):"treasures"==e.cards.inGame[a].card&&e.moveCard(e.cards.inGame[a],e.cards.inGame,e.cards.treasuresFold);r.status="outdoor",e.log("Ты справился с трудностями предыдущей комнаты."),e.giveChoice(r)},e.kickDoor=function(r){var a=n(0,e.cards.doors.length-1),s=e.cards.doors[a];e.moveCard(s,e.cards.doors,e.cards.inGame),"monster"==s.type?(e.log("За дверь оказался монстр <b>%s [%s ур.]</b>.<br><i>%s.</i>",s.name,s.level,s.text),e.fight(r,s)):"curse"==s.type&&(console.log(s),e.log("За дверью оказалось проклятие <b>%s</b>, которое тут же действует на тебя.<br><i>%s.</i>",s.name,s.text),s.apply(r),r.status="endturn",e.giveChoice(r))},e.takeTreasure=function(r,a){var s=a||n(0,e.cards.treasures.length-1),o=e.cards.treasures[s];e.moveCard(o,e.cards.treasures,r.hand),console.log("Ты получил сокровище: "+o.name)},e.wearItem=function(r,a){e.moveCard(a,r.hand,r.items),console.log("Ты сыграл карту: "+a.name)},e.playCard=function(r,a){r.apply(a),console.log("Ты сыграл карту:"+r.name),e.fight(e.player,a)},e.moveCard=function(e,r,a){var n=r.indexOf(e);a.push(e),r.splice(n,1)},e.cards={doors:[],treasures:[],doorsFold:[],treasuresFold:[],inGame:[]},e.log=function(e){for(var a=document.createElement("p"),n=1;n<arguments.length;n++)e=e.replace("%s",arguments[n]);a.innerHTML=e,r.appendChild(a)}}