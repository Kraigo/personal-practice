<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>Battle City</title>
<script type="text/javascript">	
	var date1, date2;
	var cnv, ctx, drw;
	var player;
	var ctrl, press;
	var sprite, spriteSize, background;
	var lvl, lvlBuild = {
	level1:
		[[[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[2,0,2],[2,0,2],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[2,0,2],[2,0,2],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[2,0,2],[2,0,2],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[2,0,2],[2,0,2],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[1,0,1],[1,0,1],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[1,0,1],[1,0,1],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,1],[0,0,0],[0,0,0],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[4,1,9],[4,1,9],[4,1,9],[4,1,9]],
		[[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9],[4,1,9]]]
	}
		var animation;
		var shots = [], explosions = [], enemy = [];
	function getRandom(max)
	{
		var min = 0;
		return Math.floor(Math.random() * (max - min + 1)) + min;
	}	
	function pushShot(x,y,s) {
		if (s==0) shots.push({'x':x,'y':y,'side':s,'dx':0,'dy':-1})
		else if (s==1) shots.push({'x':x+16,'y':y+16,'side':s,'dx':1,'dy':0})
		else if (s==2) shots.push({'x':x+16,'y':y+16,'side':s,'dx':0,'dy':1})
		else if (s==3) shots.push({'x':x,'y':y,'side':s,'dx':-1,'dy':0})
	}

	function init () {
		cnv = document.getElementById('cnv');
		ctx = cnv.getContext('2d');
		press = 0;
		sprite = new Image();
		sprite.src = 'sprite.png';
		spriteSize = 32;
		background = new Image();
		background.src = 'back.png';
		animation = {
			'tank' : [
				[[0,1,1,1],[2,1,3,1],[4,1,5,1],[6,1,7,1]],
				[[0,2,1,2],[2,2,3,2],[4,2,5,2],[6,2,7,2]],
				[[0,3,1,3],[2,3,3,3],[4,3,5,3],[6,3,7,3]],
				[[0,4,1,4],[2,4,3,4],[4,4,5,4],[6,4,7,5]],
				[[0,5,1,5],[2,5,3,5],[4,5,5,5],[6,5,7,4]],
				[[0,6,1,6],[2,6,3,6],[4,6,5,6],[6,6,7,6]],
				[[0,7,1,7],[2,7,3,7],[4,7,5,7],[6,7,7,7]],
				[[0,8,1,8],[2,8,3,8],[4,8,5,8],[6,8,7,8]]],
			'spawn' : [16,11,16,10,16,9,16,8],
			'shot' : [[6,0],[7,1],[6,1],[7,0]],
			'explosion' : [8,0,9,0,10,0]
			};
		lvl = 'level1';
		enemyLeft = 18;
		player = {
			'x':160,
			'y':400,
			'rank':0,
			'side':0,
			'shot':0,
			'maxShot':1,
			'speedShot':16,
			'power':1,
			'anim':0
			};
		enemy.push({
			'x':160,
			'y':192,
			'rank':0,
			'side':2,
			'shot':0,
			'maxShot':1,
			'speedShot':16,
			'power':1,
			'anim':0
			});
		enemy.push({
			'x':320,
			'y':16,
			'rank':0,
			'side':2,
			'shot':0,
			'maxShot':1,
			'speedShot':16,
			'power':1,
			'anim':0
			});
		enemy.push({
			'x':32,
			'y':16,
			'rank':0,
			'side':2,
			'shot':0,
			'maxShot':1,
			'speedShot':16,
			'power':1,
			'anim':0
			});
		enemy.push({
			'x':416,
			'y':16,
			'rank':0,
			'side':2,
			'shot':0,
			'maxShot':1,
			'speedShot':16,
			'power':1,
			'anim':0
			});
		drw = setInterval (draw,50);
	}
	
	function draw() {
		// map
		for (var i=0; i<28; i++) {
		for (var j=0; j<32; j++) {
			ctx.drawImage(
				sprite,
				lvlBuild[lvl][i][j][0]*spriteSize/2, lvlBuild[lvl][i][j][1]*spriteSize/2,
				spriteSize/2, spriteSize/2,
				j*spriteSize/2,i*spriteSize/2,
				spriteSize/2, spriteSize/2
			);
			
		}}
		
		// =base		
		ctx.drawImage(
			sprite,
			2*spriteSize, 15*spriteSize,
			spriteSize, spriteSize,
			7*spriteSize,12*spriteSize+spriteSize/2,
			spriteSize, spriteSize
		);
		
		// =player
		ctx.drawImage(
			sprite,
			animation.tank[player.rank][player.side][player.anim]*spriteSize, animation.tank[player.rank][player.side][player.anim+1]*spriteSize,
			spriteSize, spriteSize,
			player['x'],player['y'],
			spriteSize, spriteSize
		);
		
		// =enemy
		for (var i in enemy) {
			ctx.drawImage(
				sprite,
				animation.tank[enemy[i]['rank']][enemy[i]['side']][enemy[i]['anim']]*spriteSize, animation.tank[enemy[i]['rank']][enemy[i]['side']][enemy[i]['anim']+1]*spriteSize,
				spriteSize, spriteSize,
				enemy[i]['x'],enemy[i]['y'],
				spriteSize, spriteSize
			);
			if(getRandom(5)==0) {
				
				//?shot && enemy[i].shot < enemy[i].maxShot
				if (getRandom(8)==0) {				
					enemy[i].shot++;
					pushShot(enemy[i].x, enemy[i].y, enemy[i].side);
				}
				// randomSide
				if (getRandom(5)==0) enemy[i].side=getRandom(3)
				
				//?move
				if (enemy[i]['side']==0) {
					if (lvlBuild[lvl][enemy[i].y/16-1][enemy[i].x/16][2]==0
					&& lvlBuild[lvl][enemy[i].y/16-1][enemy[i].x/16+1][2]==0) {
						enemy[i].y-=16
						!enemy[i].anim? enemy[i].anim+=2: enemy[i].anim=0;
					}
					else if (getRandom(1)==0) enemy[i]['side']=getRandom(3);
				}
				else if (enemy[i]['side']==1) {
					if (lvlBuild[lvl][enemy[i].y/16][enemy[i].x/16+2][2]==0
					&& lvlBuild[lvl][enemy[i].y/16+1][enemy[i].x/16+2][2]==0) {
						enemy[i].x+=16
						!enemy[i].anim? enemy[i].anim+=2: enemy[i].anim=0;
					}
					else if (getRandom(1)==0) enemy[i]['side']=getRandom(3);
				}
				else if (enemy[i]['side']==2) {
					if (lvlBuild[lvl][enemy[i].y/16+2][enemy[i].x/16][2]==0
					&& lvlBuild[lvl][enemy[i].y/16+2][enemy[i].x/16+1][2]==0) {
						enemy[i].y+=16
						!enemy[i].anim? enemy[i].anim+=2: enemy[i].anim=0;
					}
					else if (getRandom(1)==0) enemy[i]['side']=getRandom(3);
				}
				else if (enemy[i]['side']==3) {
					if (lvlBuild[lvl][enemy[i].y/16][enemy[i].x/16-1][2]==0
					&& lvlBuild[lvl][enemy[i].y/16+1][enemy[i].x/16-1][2]==0) {
						enemy[i].x-=16
						!enemy[i].anim? enemy[i].anim+=2: enemy[i].anim=0;
					}
					else if (getRandom(1)==0) enemy[i]['side']=getRandom(3);
				}
			}
		}
		
		// =shots
		for (var i in shots) {
			ctx.drawImage(
				sprite,
				animation.shot[shots[i]['side']][0]*spriteSize/2, animation.shot[shots[i]['side']][1]*spriteSize/2,
				spriteSize/2, spriteSize/2,
				shots[i]['x']-shots[i]['dy']*13, shots[i]['y']-shots[i]['dx']*13,
				spriteSize/2, spriteSize/2
			);			
			var nextShot1 = lvlBuild[lvl][(shots[i]['y']+shots[i]['dy']*player.speedShot)/16][(shots[i]['x']+shots[i]['dx']*player.speedShot)/16],
				nextShot2 = lvlBuild[lvl][(shots[i]['y']+shots[i]['dy']*player.speedShot)/16-shots[i]['dx']][(shots[i]['x']+shots[i]['dx']*player.speedShot)/16-shots[i]['dy']];

			// ?miss
			if (nextShot1[2]==0 && nextShot2[2]==0) {
				shots[i]['x']+=shots[i]['dx']*player.speedShot;
				shots[i]['y']+=shots[i]['dy']*player.speedShot;
			} 
			
			// ?hit
			else {
				if (player.power>=nextShot1[2]) nextShot1[0]=nextShot1[1]=nextShot1[2]=0;
				if (player.power>=nextShot2[2]) nextShot2[0]=nextShot2[1]=nextShot2[2]=0;
				
				if (shots[i]['dx']>0 || shots[i]['dy']<0) shots[i]['y']-=16;
				if (shots[i]['dy']>0 || shots[i]['dx']<0) shots[i]['x']-=16;
				explosions.push({
					'x':shots[i]['x'],
					'y':shots[i]['y'],
					'step':0
				});
				shots.splice(i,1);
				break;
			}
			
			// ?enemy
			for (var j in enemy) {
				if (enemy[j]['x']<=shots[i]['x'] && enemy[j]['x']+16>shots[i]['x']
				&& enemy[j]['y']<shots[i]['y'] && enemy[j]['y']+16>shots[i]['y'])
				{
					explosions.push({
						'x':shots[i]['x'],
						'y':shots[i]['y'],
						'step':0
					});
					shots.splice(i,1);
					enemy.splice(j,1);
					break;

				}
			}
			
		}
		
		// =explosions
		for (var i in explosions) {
			ctx.drawImage(
				sprite,
				animation.explosion[explosions[i]['step']]*spriteSize, animation.explosion[explosions[i]['step']+1]*spriteSize,
				spriteSize, spriteSize,
				explosions[i]['x'], explosions[i]['y'],
				spriteSize, spriteSize
			);
			if (explosions[i]['step']<animation.explosion.length)
				explosions[i]['step']+=2;
			else {
				explosions.splice(i,1);
				player.shot -=1;
			}
			
		}
		
		// debug
		ctx.fillText(enemy,50,10);
		
		// =background
		ctx.drawImage(background,0,0);
		
	}
	
	window.onkeydown = function (event) {
		if (press==0) {
			press = event.keyCode;
			control();
			ctrl = setInterval(control,100);
		}
		if (event.keyCode==75) { // k - shots
			if (player.shot<player.maxShot) {
				player.shot +=1;
				pushShot(player.x, player.y, player.side);
			}
		}		
	}
	window.onkeyup = function(event) {
		if (event.keyCode==press) {
			clearInterval(ctrl);
			press = 0;
			
		}
	}	
	function control () {
		if (press == 65) { //left
			player.side=3;
			if (lvlBuild[lvl][player.y/16][player.x/16-1][2]==0
			&& lvlBuild[lvl][player.y/16+1][player.x/16-1][2]==0) {
				player.x-=16	
				!player.anim? player.anim+=2: player.anim=0;
			}
		}
		else if (press == 87) { //top
			player.side=0;
			if (lvlBuild[lvl][player.y/16-1][player.x/16][2]==0
			&& lvlBuild[lvl][player.y/16-1][player.x/16+1][2]==0) {
				player.y-=16	
				!player.anim? player.anim+=2: player.anim=0;
			}
		}
		else if (press == 68) { //right
			player.side=1;
			if (lvlBuild[lvl][player.y/16][player.x/16+2][2]==0
			&& lvlBuild[lvl][player.y/16+1][player.x/16+2][2]==0) {
				player.x+=16	
				!player.anim? player.anim+=2: player.anim=0;
			}				
		}
		else if (press == 83) { //bottom
			player.side=2;
			if (lvlBuild[lvl][player.y/16+2][player.x/16][2]==0
			&& lvlBuild[lvl][player.y/16+2][player.x/16+1][2]==0) {
				player.y+=16
				!player.anim? player.anim+=2: player.anim=0;
			}
		}
		else if (press == 81) {
			var debug = '';
			for (var i in lvlBuild[lvl]) {
				for (var j in lvlBuild[lvl][i]) {
					if (lvlBuild[lvl][i][j][2]=='1') debug += '[<b>'+lvlBuild[lvl][i][j][2]+'</b>]';
					else debug += '['+lvlBuild[lvl][i][j][2]+']';
				}
				debug +='<br>';
			}
			document.getElementById('debug').innerHTML = debug;
		}
	}
</script>
<style type="text/css">
*{margin:0;padding:0}
#box {
	overflow:hidden;
}
#content {
	width:711px;
	height:695px;
	padding-left:112px;
	padding-top:100px;
	background-image:url(backtv.png);
	margin:0 auto;
}
</style>
</head>

<body onLoad="init();">
<div id='box'>
	<div id="content">
		<canvas id="cnv" width="512" height="448"></canvas>
    </div>
</div>
<div id="debug"></div>


</body></html>